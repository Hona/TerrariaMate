# Workflow name
name: Deploy Code

# Controls when the workflow will run
on:
  # This is a reusable workflow
  workflow_call:
    inputs:
      environment:
        required: true
        type: string

defaults:
  run:
    shell: pwsh

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  deploy_code:
    if: github.event_name != 'pull_request'
    runs-on: ubuntu-latest
    env:
      AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
    steps:
      - uses: actions/download-artifact@v2

      - uses: azure/login@v1
        with:
          creds: ${{ env.AZURE_CREDENTIALS }}
          enable-AzPSSession: true

      - name: Deploy CDN
        working-directory: ./artifact
        run: |
          az webapp deployment source config-zip `
            -n TerrariaMate-CDN `
            --resource-group TerrariaMate-${{ inputs.environment }} `
            --src $webAppZipPath
